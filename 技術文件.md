# 記帳系統技術文件

## 📋 目錄
1. [系統概述](#系統概述)
2. [系統需求](#系統需求)
3. [安裝步驟](#安裝步驟)
4. [功能說明](#功能說明)
5. [文件結構](#文件結構)
6. [數據庫設計](#數據庫設計)
7. [使用指南](#使用指南)
8. [常見問題](#常見問題)

---

## 系統概述

這是一個基於 PHP 和 MySQL 開發的個人記帳系統，具備完整的用戶註冊、登入功能，以及強大的收支管理和數據分析功能。

### 主要特色
- ✅ 用戶註冊和登入系統
- ✅ 收入和支出記錄
- ✅ 多種類別分類管理
- ✅ 月度報表統計
- ✅ 圖表數據分析
- ✅ Excel 導出功能
- ✅ 響應式設計（支持手機、平板、電腦）
- ✅ 數據持久化存儲

### 技術棧
- **前端**: HTML5, CSS3, JavaScript, Chart.js
- **後端**: PHP 7.0+
- **數據庫**: MySQL 5.7+
- **伺服器**: Apache

---

## 系統需求

### 軟體需求
- XAMPP (包含 Apache + MySQL + PHP) 或類似的 PHP 開發環境
- 現代瀏覽器（Chrome, Firefox, Safari, Edge）

### 硬體需求
- 最低配置：1GB RAM, 100MB 磁碟空間
- 建議配置：2GB+ RAM, 500MB+ 磁碟空間

---

## 安裝步驟

### 1. 環境準備
1. 下載並安裝 XAMPP
2. 啟動 XAMPP Control Panel
3. 啟動 Apache 和 MySQL 服務

### 2. 項目部署
1. 將項目文件放到 `C:\xampp\htdocs\phplogin\` 目錄
2. 確保所有 PHP 文件和資源文件都已複製

### 3. 數據庫設置

#### 步驟 1：創建數據庫
訪問 `http://localhost/phpmyadmin`，執行以下 SQL：

```sql
CREATE DATABASE IF NOT EXISTS db2 
CHARACTER SET utf8mb4 
COLLATE utf8mb4_unicode_ci;
```

#### 步驟 2：創建用戶表
```sql
USE db2;

CREATE TABLE IF NOT EXISTS users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    email VARCHAR(100) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

#### 步驟 3：創建記帳表
```sql
CREATE TABLE IF NOT EXISTS expenses (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    type ENUM('income', 'expense') NOT NULL DEFAULT 'expense',
    category VARCHAR(50) NOT NULL,
    amount DECIMAL(10, 2) NOT NULL,
    description TEXT,
    expense_date DATE NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

### 4. 配置文件
檢查 `connection.php` 的數據庫連接設置：

```php
$servername = "localhost";
$username = "root";
$password = "";
$db_name = "db2";
```

### 5. 訪問系統
在瀏覽器中輸入：`http://localhost/phplogin/`

---

## 功能說明

### 1. 用戶管理系統

#### 註冊功能 (`register.php`)
- 用戶名驗證（最少 3 個字符）
- 密碼驗證（最少 6 個字符）
- 電子郵件驗證
- 用戶名唯一性檢查
- 自動表單驗證

#### 登入功能 (`index.php`)
- 用戶名和密碼驗證
- Session 管理
- 登入失敗提示
- 自動跳轉到歡迎頁面

#### 登出功能 (`logout.php`)
- 清除 Session
- 安全登出
- 自動跳轉到登入頁面

### 2. 記帳系統

#### 新增記錄
**支出類別：**
- 🍔 飲食
- 🚗 交通
- 🎮 娛樂
- 🛍️ 購物
- 💡 帳單
- 📌 其他

**收入類別：**
- 💼 薪水
- 🎁 獎金
- 📈 投資
- 📌 其他

**記錄欄位：**
- 類型（收入/支出）
- 類別
- 金額（支持小數點後兩位）
- 日期
- 說明（選填）

#### 記帳記錄查看
- 按日期降序排列
- 顏色區分收入/支出
- 類別標籤顯示
- 快速刪除功能
- 確認提示防誤刪

#### 統計分析
**首頁統計卡片：**
- 💰 總收入
- 💸 總支出
- 💵 結餘
- 📝 記帳筆數

**類別統計：**
- 支出類別統計
- 收入類別統計
- 金額匯總
- 視覺化標籤

### 3. 月度報表
- 顯示最近 6 個月數據
- 每月收入、支出、結餘
- 表格化展示
- 顏色標識正負值

### 4. 圖表分析

#### 月度收支趨勢圖（柱狀圖）
- 收入和支出對比
- 最近 6 個月趨勢
- 互動式圖表
- 數據標籤顯示

#### 支出類別分布圖（圓餅圖）
- 各類別支出佔比
- 顏色區分類別
- 百分比顯示
- 圖例說明

### 5. 導出功能
- 一鍵導出為 CSV 文件
- 包含所有記帳記錄
- 支持 Excel 打開
- UTF-8 編碼（正確顯示中文）
- 自動命名（包含日期）

---

## 文件結構

```
phplogin/
│
├── connection.php          # 數據庫連接配置
├── index.php              # 登入頁面
├── register.php           # 註冊頁面
├── login.php              # 登入處理
├── logout.php             # 登出處理
├── welcome.php            # 歡迎頁面
├── expense.php            # 記帳系統主頁面
├── export.php             # Excel 導出功能
├── style.css              # 全局樣式表
│
├── expense_table.sql      # 記帳表創建 SQL（舊版）
├── update_expense_table.sql  # 記帳表更新 SQL
├── EXPENSE_README.md      # 記帳系統說明
└── 技術文件.md            # 本技術文件
```

---

## 數據庫設計

### 表結構

#### users 表（用戶表）
| 欄位名 | 類型 | 說明 | 約束 |
|--------|------|------|------|
| id | INT | 用戶 ID | PRIMARY KEY, AUTO_INCREMENT |
| username | VARCHAR(50) | 用戶名 | NOT NULL, UNIQUE |
| password | VARCHAR(255) | 密碼 | NOT NULL |
| email | VARCHAR(100) | 電子郵件 | NOT NULL |
| created_at | TIMESTAMP | 創建時間 | DEFAULT CURRENT_TIMESTAMP |

#### expenses 表（記帳表）
| 欄位名 | 類型 | 說明 | 約束 |
|--------|------|------|------|
| id | INT | 記錄 ID | PRIMARY KEY, AUTO_INCREMENT |
| user_id | INT | 用戶 ID | NOT NULL |
| type | ENUM | 類型（income/expense） | NOT NULL, DEFAULT 'expense' |
| category | VARCHAR(50) | 類別 | NOT NULL |
| amount | DECIMAL(10,2) | 金額 | NOT NULL |
| description | TEXT | 說明 | NULL |
| expense_date | DATE | 日期 | NOT NULL |
| created_at | TIMESTAMP | 創建時間 | DEFAULT CURRENT_TIMESTAMP |

### 數據關係
- `expenses.user_id` 關聯 `users.id`
- 一個用戶可以有多筆記帳記錄
- 刪除用戶時相關記帳記錄也會被刪除（如果設置了外鍵）

---

## 使用指南

### 新用戶註冊
1. 訪問 `http://localhost/phplogin/`
2. 點擊「立即註冊」
3. 填寫用戶名（至少 3 個字符）
4. 填寫密碼（至少 6 個字符）
5. 填寫電子郵件
6. 點擊「註冊」按鈕
7. 註冊成功後自動跳轉到登入頁面

### 登入系統
1. 在登入頁面輸入用戶名和密碼
2. 點擊「登入」按鈕
3. 登入成功後進入歡迎頁面
4. 點擊「💰 記帳系統」進入記帳功能

### 記錄支出
1. 在記帳系統頁面左側表單中
2. 選擇「類型」→「支出」
3. 選擇「類別」（飲食、交通等）
4. 輸入「金額」
5. 選擇「日期」（默認今天）
6. 輸入「說明」（選填）
7. 點擊「新增記錄」

### 記錄收入
1. 選擇「類型」→「收入」
2. 選擇「類別」（薪水、獎金等）
3. 輸入金額和日期
4. 點擊「新增記錄」

### 查看月度報表
1. 在記帳記錄區域
2. 點擊「月度報表」標籤
3. 查看每月收入、支出、結餘統計

### 查看圖表分析
1. 點擊「圖表分析」標籤
2. 查看月度收支趨勢圖
3. 查看支出類別分布圖

### 導出記錄
1. 點擊右上角「📊 導出 Excel」按鈕
2. 文件會自動下載為 CSV 格式
3. 使用 Excel 或 Google Sheets 打開

### 刪除記錄
1. 在記帳記錄列表中找到要刪除的記錄
2. 點擊該行的「刪除」按鈕
3. 確認刪除操作
4. 記錄會立即從數據庫中移除

---

## 常見問題

### Q1: 為什麼頁面顯示空白？
**A:** 檢查以下幾點：
1. Apache 服務是否已啟動
2. 文件是否在正確的目錄（`C:\xampp\htdocs\phplogin\`）
3. 訪問的 URL 是否正確（`http://localhost/phplogin/`）
4. 檢查 PHP 錯誤日誌

### Q2: 為什麼出現 "Table doesn't exist" 錯誤？
**A:** 數據庫表尚未創建，請按照[安裝步驟](#安裝步驟)中的數據庫設置部分執行 SQL 語句。

### Q3: 為什麼登入失敗？
**A:** 檢查：
1. 用戶名和密碼是否正確
2. 數據庫連接是否正常
3. `users` 表是否已創建
4. 用戶是否已註冊

### Q4: 為什麼無法新增記帳記錄？
**A:** 確認：
1. `expenses` 表是否已創建
2. 是否已登入系統
3. 表單是否填寫完整
4. 數據庫連接是否正常

### Q5: 圖表為什麼不顯示？
**A:** 
1. 確保有記帳數據
2. 檢查瀏覽器控制台是否有 JavaScript 錯誤
3. 確認 Chart.js CDN 是否載入成功
4. 嘗試刷新頁面

### Q6: 導出的 CSV 文件中文亂碼？
**A:** 
- 使用 Excel 打開時選擇「數據」→「從文本」→ 選擇「UTF-8」編碼
- 或使用 Google Sheets 打開（自動識別 UTF-8）

### Q7: 如何修改數據庫連接設置？
**A:** 編輯 `connection.php` 文件：
```php
$servername = "localhost";    // 數據庫主機
$username = "root";           // 數據庫用戶名
$password = "";               // 數據庫密碼
$db_name = "db2";            // 數據庫名稱
```

### Q8: 忘記密碼怎麼辦？
**A:** 目前系統沒有密碼重置功能，可以：
1. 直接在 phpMyAdmin 中修改 `users` 表的密碼
2. 或重新註冊一個新帳號

### Q9: 如何備份數據？
**A:** 
1. 訪問 phpMyAdmin
2. 選擇 `db2` 數據庫
3. 點擊「導出」
4. 選擇「快速」或「自定義」
5. 下載 SQL 文件保存

### Q10: 數據會丟失嗎？
**A:** 
- 所有數據存儲在 MySQL 數據庫中
- 刷新頁面不會丟失數據
- 除非數據庫被刪除或損壞
- 建議定期備份數據庫

---

## 安全建議

### 1. 密碼安全
⚠️ **當前版本的密碼是明文存儲，不安全！**

**改進建議：**
```php
// 註冊時加密密碼
$hashed_password = password_hash($password, PASSWORD_DEFAULT);

// 登入時驗證密碼
if (password_verify($password, $hashed_password)) {
    // 密碼正確
}
```

### 2. SQL 注入防護
✅ **當前版本已使用預處理語句（Prepared Statements）**

繼續保持使用：
```php
$stmt = $conn->prepare("SELECT * FROM users WHERE username = ?");
$stmt->bind_param("s", $username);
```

### 3. XSS 防護
✅ **當前版本已使用 htmlspecialchars()**

顯示用戶輸入時：
```php
echo htmlspecialchars($user_data, ENT_QUOTES, 'UTF-8');
```

### 4. Session 安全
建議在 `connection.php` 添加：
```php
session_start();
session_regenerate_id(true);  // 防止 session 劫持
```

### 5. HTTPS
- 生產環境應使用 HTTPS
- 保護數據傳輸安全

---

## 未來改進建議

### 功能擴展
- [ ] 密碼加密存儲
- [ ] 忘記密碼功能
- [ ] 用戶頭像上傳
- [ ] 記帳記錄編輯功能
- [ ] 預算設定和提醒
- [ ] 定期收支設定
- [ ] 多幣種支持
- [ ] 附件上傳（發票照片）
- [ ] 標籤功能
- [ ] 搜索和篩選功能
- [ ] 年度報表
- [ ] 更多圖表類型
- [ ] 數據對比分析
- [ ] 移動 App

### 性能優化
- [ ] 數據分頁
- [ ] 查詢優化
- [ ] 緩存機制
- [ ] 圖片壓縮

### 用戶體驗
- [ ] 深色模式
- [ ] 多語言支持
- [ ] 自定義主題
- [ ] 快捷鍵支持
- [ ] 離線模式

---

## 技術支持

### 問題回報
如遇到問題，請提供：
1. 錯誤信息截圖
2. 瀏覽器控制台錯誤
3. PHP 錯誤日誌
4. 操作步驟

### 聯絡方式
- 項目目錄：`C:\xampp\htdocs\phplogin\`
- phpMyAdmin：`http://localhost/phpmyadmin`

---

## 版本資訊

**當前版本：** v1.0.0  
**發布日期：** 2025-11-11  
**開發環境：** XAMPP + PHP + MySQL  

### 版本歷史
- **v1.0.0** (2025-11-11)
  - 初始版本發布
  - 用戶註冊登入功能
  - 收支記錄功能
  - 月度報表
  - 圖表分析
  - Excel 導出

---

## 授權聲明

本項目僅供學習和個人使用。

---

## 附錄

### A. 完整 SQL 安裝腳本

```sql
-- 創建數據庫
CREATE DATABASE IF NOT EXISTS db2 
CHARACTER SET utf8mb4 
COLLATE utf8mb4_unicode_ci;

USE db2;

-- 創建用戶表
CREATE TABLE IF NOT EXISTS users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    email VARCHAR(100) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- 創建記帳表
CREATE TABLE IF NOT EXISTS expenses (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    type ENUM('income', 'expense') NOT NULL DEFAULT 'expense',
    category VARCHAR(50) NOT NULL,
    amount DECIMAL(10, 2) NOT NULL,
    description TEXT,
    expense_date DATE NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

### B. 快速訪問連結

| 功能 | URL |
|------|-----|
| 登入頁面 | http://localhost/phplogin/ |
| 註冊頁面 | http://localhost/phplogin/register.php |
| 記帳系統 | http://localhost/phplogin/expense.php |
| phpMyAdmin | http://localhost/phpmyadmin |

---

**文件結束**

📅 最後更新：2025-11-11  
📝 文件版本：1.0  
👨‍💻 技術棧：PHP + MySQL + JavaScript + Chart.js
